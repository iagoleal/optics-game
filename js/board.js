// Generated by CoffeeScript 1.6.3
(function() {
  var ConcaveMirror, ConvexMirror, Laser, LaserGun, Mirror, PlaneMirror, Turnable, _ref, _ref1, _ref2, _ref3, _ref4,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  Turnable = (function() {
    Turnable.prototype.position = null;

    Turnable.prototype.angle = 0;

    function Turnable(position, angle) {
      this.position = position != null ? position : {
        x: 0,
        y: 0
      };
      this.angle = angle != null ? angle : 0;
    }

    Turnable.prototype.turn = function(dgr) {
      this.angle += dgr;
      if (this.angle > 360) {
        this.angle -= 360;
      } else if (this.angle < 0) {
        this.angle += 360;
      }
      return this;
    };

    return Turnable;

  })();

  Mirror = (function(_super) {
    __extends(Mirror, _super);

    function Mirror() {
      _ref = Mirror.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    Mirror.prototype.img = null;

    Mirror.prototype.width = 100;

    Mirror.prototype.height = 10;

    Mirror.prototype.type = "Mirror";

    return Mirror;

  })(Turnable);

  PlaneMirror = (function(_super) {
    __extends(PlaneMirror, _super);

    function PlaneMirror() {
      _ref1 = PlaneMirror.__super__.constructor.apply(this, arguments);
      return _ref1;
    }

    PlaneMirror.prototype.collided = function(point) {
      var c, rx, ry, s;
      c = Math.cos(-this.angle * Math.PI / 180);
      s = Math.sin(-this.angle * Math.PI / 180);
      rx = this.position.x + c * (point.x - this.position.x) - s * (point.y - this.position.y);
      ry = this.position.y + s * (point.x - this.position.x) + c * (point.y - this.position.y);
      return this.position.x - this.width / 2 <= rx && this.position.x + this.width / 2 >= rx && this.position.y - this.height / 2 <= ry && this.position.y + this.height / 2 >= ry;
    };

    PlaneMirror.prototype.reflect = function(ang) {
      var mangle;
      mangle = this.angle;
      if (mangle >= 180) {
        mangle -= 180;
      }
      return ang + 2 * mangle;
    };

    PlaneMirror.prototype.draw = function(context) {
      drawer.rectangle(context, "fill", this.angle, this.position, this.width, this.height, {
        color: 'black',
        shadow: {
          color: '#fff',
          offsetX: 0,
          offsetY: 0,
          blur: 10
        }
      });
      return drawer.distance(context, 45 + this.angle, this.position, 100, {
        color: 'white'
      });
    };

    return PlaneMirror;

  })(Mirror);

  ConvexMirror = (function(_super) {
    __extends(ConvexMirror, _super);

    function ConvexMirror() {
      _ref2 = ConvexMirror.__super__.constructor.apply(this, arguments);
      return _ref2;
    }

    return ConvexMirror;

  })(Mirror);

  ConcaveMirror = (function(_super) {
    __extends(ConcaveMirror, _super);

    function ConcaveMirror() {
      _ref3 = ConcaveMirror.__super__.constructor.apply(this, arguments);
      return _ref3;
    }

    return ConcaveMirror;

  })(Mirror);

  LaserGun = (function(_super) {
    __extends(LaserGun, _super);

    function LaserGun() {
      _ref4 = LaserGun.__super__.constructor.apply(this, arguments);
      return _ref4;
    }

    LaserGun.prototype.radius = 30;

    LaserGun.prototype.img = null;

    LaserGun.prototype.front = function() {
      return {
        x: this.position.x + this.radius * Math.cos(this.angle * Math.PI / 180),
        y: this.position.y + this.radius * Math.sin(this.angle * Math.PI / 180)
      };
    };

    LaserGun.prototype.draw = function(context) {
      return drawer.polygon(context, "stroke", this.angle, this.position, 3, this.radius, {
        width: 1,
        color: 'white'
      });
    };

    return LaserGun;

  })(Turnable);

  Laser = (function() {
    Laser.prototype.path = null;

    function Laser(origin) {
      this.path = [];
      if (origin) {
        this.path.push(origin);
      }
    }

    Laser.prototype.addPoint = function(p) {
      return this.path.push(p);
    };

    Laser.prototype.angle = function(point) {
      var dx, dy, _ref5;
      if (point == null) {
        point = -1;
      }
      _ref5 = this.changeRate(point), dy = _ref5[0], dx = _ref5[1];
      return Math.atan2(dy, dx) * 180 / Math.PI;
    };

    Laser.prototype.changeRate = function(point) {
      var dx, dy;
      if (point == null) {
        point = -1;
      }
      if (point < 0) {
        point = this.path.length + point;
      }
      if (point < this.path.length && point > 0) {
        dx = this.path[point].x - this.path[point - 1].x;
        dy = this.path[point].y - this.path[point - 1].y;
        return [dy, dx];
      }
      return [0, 0];
    };

    Laser.prototype.last = function(p) {
      if (p) {
        if (this.path.length > 1) {
          this.path[this.path.length - 1] = p;
        } else {
          this.path[this.path.length] = p;
        }
      }
      return {
        x: this.path[this.path.length - 1].x,
        y: this.path[this.path.length - 1].y
      };
    };

    Laser.prototype.advance = function(rate) {
      var dx, dy, pos;
      if (rate == null) {
        rate = 10;
      }
      pos = this.path[this.path.length - 1];
      if (!(dy || dx)) {
        dx = this.path[this.path.length - 1].x - this.path[this.path.length - 2].x;
        dy = this.path[this.path.length - 1].y - this.path[this.path.length - 2].y;
      }
      if (dx === 0) {
        pos.x = this.last().x;
        pos.y += dy > 0 ? rate : -rate;
      } else {
        pos.x += dx > 0 ? rate : -rate;
        pos.y += dx > 0 ? rate * dy / dx : -rate * dy / dx;
      }
      return this.last(pos);
    };

    Laser.prototype.clear = function() {
      var point, _i, _len, _results;
      this.path = [];
      _results = [];
      for (_i = 0, _len = arguments.length; _i < _len; _i++) {
        point = arguments[_i];
        _results.push(this.path.push(point));
      }
      return _results;
    };

    Laser.prototype.draw = function(context) {
      var p1, p2, _i, _len, _ref5, _results;
      if (this.path.length > 1) {
        p1 = this.path[0];
        _ref5 = this.path.slice(1);
        _results = [];
        for (_i = 0, _len = _ref5.length; _i < _len; _i++) {
          p2 = _ref5[_i];
          drawer.line(context, p1, p2, {
            color: '#ddeeff',
            width: 5,
            shadow: {
              join: "bevel",
              color: '#a00',
              offsetX: 0,
              offsetY: 0,
              blur: 25
            }
          });
          _results.push(p1 = p2);
        }
        return _results;
      }
    };

    return Laser;

  })();

  window.PlaneMirror = PlaneMirror;

  window.LaserGun = LaserGun;

  window.Laser = Laser;

}).call(this);
